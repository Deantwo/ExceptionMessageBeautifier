require('approvals').configure({
        reporters:  ["visualstudio"]
    }).mocha(__dirname);

var formatException = require("../src/ExceptionMessageBeautifier.js").format;

describe('When prettyifying DotNet Exception Messages', function () {

    it('formats a basic exception', function () {
        var data = "System.Exception: Hello Exception!   at TestExceptionGenerator.Spike.GetException() in c:\\Code\\personal\\DotNetExceptionMessageFormatter\\TestExceptionGenerator\\Spike.cs:line 22   at TestExceptionGenerator.Spike.<GenericException>b__0() in c:\\Code\\personal\\DotNetExceptionMessageFormatter\\TestExceptionGenerator\\Spike.cs:line 13   at TestExceptionGenerator.Extensions.GetExceptionString(Action action) in c:\\Code\\personal\\DotNetExceptionMessageFormatter\\TestExceptionGenerator\\Spike.cs:line 34";

        var result = formatException(data);

        this.verify(result);
    });


    it('formats an exception with an inner exception', function(){
        var data = 'System.Exception: Test outer exception ---> System.Exception: Hello Exception!   at TestExceptionGenerator.Spike.GetException() in c:\\Code\\personal\\DotNetExceptionMessageFormatter\\TestExceptionGenerator\\Spike.cs:line 29   at TestExceptionGenerator.Spike.GetInnerException() in c:\\Code\\personal\\DotNetExceptionMessageFormatter\\TestExceptionGenerator\\Spike.cs:line 36   --- End of inner exception stack trace ---   at TestExceptionGenerator.Spike.GetInnerException() in c:\\Code\\personal\\DotNetExceptionMessageFormatter\\TestExceptionGenerator\\Spike.cs:line 41   at TestExceptionGenerator.Spike.<GenericExceptionWithInnerException>b__1() in c:\\Code\\personal\\DotNetExceptionMessageFormatter\\TestExceptionGenerator\\Spike.cs:line 21   at TestExceptionGenerator.Extensions.GetExceptionString(Action action) in c:\\Code\\personal\\DotNetExceptionMessageFormatter\\TestExceptionGenerator\\Spike.cs:line 56'

        var result = formatException(data);

        this.verify(result);
    });

    it('spike', function(){
        var data = "System.ArgumentException: The parameters dictionary contains a null entry for parameter 'planId' of non-nullable type 'System.Int32' for method 'System.Web.Mvc.ActionResult Processing(Int32)' in 'Resgrid.Web.Areas.User.Controllers.SubscriptionController'. An optional parameter must be a reference type, a nullable type, or be declared as an optional parameter.Parameter name: parameters   at System.Web.Mvc.ActionDescriptor.ExtractParameterFromDictionary(ParameterInfo parameterInfo, IDictionary`2 parameters, MethodInfo methodInfo)   at System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters)   at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters)   at System.Web.Mvc.Async.AsyncControllerActionInvoker.ActionInvocation.InvokeSynchronousActionMethod()   at System.Web.Mvc.Async.AsyncControllerActionInvoker.<BeginInvokeSynchronousActionMethod>b__36(IAsyncResult asyncResult, ActionInvocation innerInvokeState)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult`2.CallEndDelegate(IAsyncResult asyncResult)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResultBase`1.End()   at System.Web.Mvc.Async.AsyncResultWrapper.End[TResult](IAsyncResult asyncResult, Object tag)   at System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeActionMethod(IAsyncResult asyncResult)   at System.Web.Mvc.Async.AsyncControllerActionInvoker.AsyncInvocationWithFilters.<InvokeActionMethodFilterAsynchronouslyRecursive>b__3c()   at System.Web.Mvc.Async.AsyncControllerActionInvoker.AsyncInvocationWithFilters.<>c__DisplayClass45.<InvokeActionMethodFilterAsynchronouslyRecursive>b__3e()   at System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass30.<BeginInvokeActionMethodWithFilters>b__2f(IAsyncResult asyncResult)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult`1.CallEndDelegate(IAsyncResult asyncResult)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResultBase`1.End()   at System.Web.Mvc.Async.AsyncResultWrapper.End[TResult](IAsyncResult asyncResult, Object tag)   at System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeActionMethodWithFilters(IAsyncResult asyncResult)   at System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass1e.<>c__DisplayClass28.<BeginInvokeAction>b__19()   at System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass1e.<BeginInvokeAction>b__1b(IAsyncResult asyncResult)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult`1.CallEndDelegate(IAsyncResult asyncResult)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResultBase`1.End()   at System.Web.Mvc.Async.AsyncResultWrapper.End[TResult](IAsyncResult asyncResult, Object tag)   at System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeAction(IAsyncResult asyncResult)   at System.Web.Mvc.Controller.<BeginExecuteCore>b__1d(IAsyncResult asyncResult, ExecuteCoreState innerState)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncVoid`1.CallEndDelegate(IAsyncResult asyncResult)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResultBase`1.End()   at System.Web.Mvc.Async.AsyncResultWrapper.End[TResult](IAsyncResult asyncResult, Object tag)   at System.Web.Mvc.Async.AsyncResultWrapper.End(IAsyncResult asyncResult, Object tag)   at System.Web.Mvc.Controller.EndExecuteCore(IAsyncResult asyncResult)   at System.Web.Mvc.Controller.<BeginExecute>b__15(IAsyncResult asyncResult, Controller controller)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncVoid`1.CallEndDelegate(IAsyncResult asyncResult)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResultBase`1.End()   at System.Web.Mvc.Async.AsyncResultWrapper.End[TResult](IAsyncResult asyncResult, Object tag)   at System.Web.Mvc.Async.AsyncResultWrapper.End(IAsyncResult asyncResult, Object tag)   at System.Web.Mvc.Controller.EndExecute(IAsyncResult asyncResult)   at System.Web.Mvc.Controller.System.Web.Mvc.Async.IAsyncController.EndExecute(IAsyncResult asyncResult)   at System.Web.Mvc.MvcHandler.<BeginProcessRequest>b__4(IAsyncResult asyncResult, ProcessRequestState innerState)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncVoid`1.CallEndDelegate(IAsyncResult asyncResult)   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResultBase`1.End()   at System.Web.Mvc.Async.AsyncResultWrapper.End[TResult](IAsyncResult asyncResult, Object tag)   at System.Web.Mvc.Async.AsyncResultWrapper.End(IAsyncResult asyncResult, Object tag)   at System.Web.Mvc.MvcHandler.EndProcessRequest(IAsyncResult asyncResult)   at System.Web.Mvc.MvcHandler.System.Web.IHttpAsyncHandler.EndProcessRequest(IAsyncResult result)   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously)"
        var result = formatException(data);
        this.verify(result);
    });
});
